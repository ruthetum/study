# chapter 01. 서문

동시성 프로그래밍은 새로 등장한 개념은 아니지만 점점 중요해지고 있음
- erlang, go, scala, clojure 같은 언들이 동시성을 잘 지원하고 있음

멀티코어로 인해 동시성에 대한 관심이 급증
- 과거에는 더 빠른 하드웨어가 출시를 기다리기만 하면 소프트웨어의 속도가 향상  (허브 서터, '공짜 점심은 끝났다')
- 이제는 여러 개의 코어, 병렬성을 잘 활용해야 속도가 향상

## 1.1. 동시성 혹은 병렬성?

동시성과 병렬성은 종종 비슷한 의미로 사용되지만, 실제로는 서로 다른 개념

### 동시성 프로그램
- 여러 개의 논리적 통제 흐름(threads of control)을 갖음
- 논리적 흐름, 즉 스레드는 병렬로 실행될 수도 있고, 그렇지 않을 수도 있음

### 병렬성 프로그램
- 계산에 필요한 부분을 한 번에 (병렬로) 실행함으로써 순차적 프로그램보다 빨리 동작 가능
- 프로그램에서 사용되는 논리적 통제 흐름은 하나가 될 수도 있고, 여러 개가 될 수도 있음

> - 동시성은 여러 일을 한 번에 다루는 데 관한 것
> - 병렬성은 여러 일을 한 번에 실행하는 데 관한 것

#### 동시성과 병렬성에 대한 예
> 학교에서 교사는 멀티태스킹에 능숙하다. 
> 
> 어느 한 시점을 볼 때 교사는 한 가지 일을 수행하지만, 언제나 여러 일을 한 번에 다루어야 한다. 학생들에게 수업을 진행함과 동시에, 시끄러운 교실을 진정시키고, 학생들의 질문에 답변을 준다.
> 
> => 이는 동시성이지 병렬성은 아니다. 교사는 한 명뿐이다.

> 해당 교사를 돕는 동료 교사가 있어서 한 교사가 수업을 진행하는 동안 다른 교사는 질문에 답변을 하는 형태라면
> 
> => 이는 동시성과 병렬성이 모두 가능해진 상태다.

> 만약 교실에서 연하장 카드를 디자인해서 생산해야 하는 일이 있고, 학생 한 명당 다섯 개씩 만들도록 할당한다면 카드를 만드는 한 가지 일을 여러 학생들이 병럴적으로 진행하게 된다.
> 
> => 이는 병렬적이지만 상위 수준에서 바라봤을 때 한 가지 일을 수행하기 때문에 동시적인 것은 아니다.

### 동시성과 병렬성이 혼동되는 이유
전통적으로 사용하는 스레드와 잠금 장치는 병렬성을 직접 지원하지 않음
- 이러한 스레드와 잠금장치를 이용해서 멀티코어를 활용하는 유일한 방법은 동시적인 프로그램을 작성해서 병렬로 동작하는 하드웨어에서 실행시키는 것

하지만 이렇게 하는 것이 쉽지 않은 이유는 동시성 프로그램은 기본적으로 비결정적(non-deterministic)이기 때문
- 사건이 일어나는 시점, 즉 타이밍에 따라서 결과 달라짐

## 1.2. 병렬 아키텍처
보통 병렬성을 이야기하면 여러 개의 코어를 떠올리지만, 현대 컴퓨터는 코어뿐만 아니라 여러 수준에서 다양한 병렬성을 지원함

#### 비트 수준 병렬성
32비트 컴퓨터가 8비트 컴퓨터보다 빠른 이유는 병렬성 때문
- 8비트 컴퓨터가 32비트 수를 더하고 싶으면 8비트 명령들의 수열을 생성해야 함
- 32비트 컴퓨터는 각각 4바이트 수를 병렬로 한 번에 처리

#### 명령어 수준 병렬성
현대 CPU는 파이프라이닝, 비순차실행, 추측 실행 등의 기법을 이용하며 매우 병렬적

#### 데이터 병렬성
데이터 병렬(Single Instruction Multiple Data, SIMD) 아키텍처는 대량의 데이터에 대해 똑같은 작업을 병렬적인 방식으로 수행

### 태스크 수준 병렬성
공유 메모리 멀티 프로세서에서는 각 프로세서가 메모리의 모든 부분에 자유롭게 접근할 수 있음

분산 메모리 시스템은 각 프로세서가 자신의 메모리를 가지고, 프로세서 사이의 커뮤니케이션은 주로 네트워크를 통해 이루어짐

공유 메모리 멀티프로세서의 경우 코드를 작성하는 것이 쉽지만, 프로세서가 일정한 수를 넘어서면 공유 메모리는 병목 혀상이 생기므로, 이 때부터는 분산 메모리르 사용할 수 밖에 없음
- 하드웨어 결함에 대비한 장애 허용(fault tolerant) 시스템을 구축하기 위해서는 분산 메모리는 불가피한 선택

## 1.3. 동시성: 멀티코어를 넘어서

## 1.4. 일곱가지 동시성 모델
#### (1) 스레드와 잠금장치
스레드와 잠금장치는 문제점이 많지만, 다양한 모델의 배후에서 동작하는 기본 기술에 해당

많은 동시성 프로그램에서 여전히 기본적으로 많이 활용

#### (2) 함수형 프로그래밍
함수형 프로그래밍은 동시성과 병렬성을 잘 지원할 뿐만 아니라 여러 이유로도 사용이 확산

가변 상태를 원처적으로 제거했기 때문에 함수형 프로그래밍은 기본적으로 스레드 안전을 보장하며 병렬처리가 용이

#### (3) 클로저 방식 - 아이덴티티와 상태 분리하기
클로저 언어는 명령형 프로그래밍과 함수형 프로그래밍을 효과적으로 결합하여 양쪽의 접근 방식이 지난 장점을 극대화

#### (4) 액터
액터 모델은 광범위한 사용처를 가진 범용의 동시성 프로그래밍 모델

공유 메모리와 분산 메모리 아키텍처 양측에서 활용 가능

#### (5) 순차 프로세스 통신(Communication Sequential Process, CSP)
순차 프로세스 통신은 액터 모델과 같이 메세지를 전달하는 방식으로 동작하지만, CSP에서는 커뮤니케이션을 위해 액터 같은 객체가 아닌 채널을 사용

#### (6) 데이터 병렬성
GPU는 주로 그래픽 처리를 위해 서 데이터 병렬성을 활용하지만, 그 외에도 다양한 계산 기능에 활용 가능

#### (7) 람다 아키텍처
람다 아키텍처는 맵리듀스와 스트리밍 프로세스의 장점을 결합해서 빅데이터 문제를 해결할 수 있음